{% extends 'communication_channel/main.html' %}
{% load static %}
{% block content %}
    <script>
    function getURL() {
        alert("The URL of this page is: " + window.location.href);
    }
    </script>
    <main>
        <section id="form-container">

            <img id="logo" src="{% static 'images/chat-icon.png' %}"/>

            <div id="welcome-message">
                <h1>Welcome to Virtual Classroom</h1>
                <p>An online classroom platform!</p>

            </div>

            <form id="form1">
                <div class="field-wrapper">

                    <div class="form-field">
                        <input type="hidden" name="room" placeholder="Enter room name..."
                               style="text-transform:uppercase"/>
                    </div>

                    <div class="form-field">
                        <button onclick="handleSubmit1()" type="button">Join Private Channel </button>
                    </div>
                </div>
            </form>
            <form id="form2">
                <div class="field-wrapper">

                    <div class="form-field">
                        <input type="hidden" name="room" placeholder="Enter room name..."
                               style="text-transform:uppercase"/>
                    </div>

                    <div class="form-field">
                        <button onclick="handleSubmit2()" type="button">Join Common Channel</button>
                    </div>
                </div>
            </form>
        </section>
    </main>

    <script>
        let form = document.getElementById('form')
        const urlParams = new URLSearchParams(window.location.search);
        const room_name = urlParams.get('greeting');

        let handleSubmit1 = async (e) => {

            room = room_name
            room += ' (private)'

            let response = await fetch(`lobby/get_token/?channel=${room}`)
            let data = await response.json()

            //room = data_room_name.room_name
            name = data.name
            let UID = data.uid
            let token = data.token

            sessionStorage.setItem('UID', UID)
            sessionStorage.setItem('token', token)
            sessionStorage.setItem('room', room)
            sessionStorage.setItem('name', name)

            window.open('room/', '_self')
        }

        let handleSubmit2 = async (e) => {

            room = room_name
            room += ' (common)'
            let response = await fetch(`lobby/get_token/?channel=${room}`)
            let data = await response.json()

            //room = data_room_name.room_name
            name = data.name
            let UID = data.uid
            let token = data.token



            sessionStorage.setItem('UID', UID)
            sessionStorage.setItem('token', token)
            sessionStorage.setItem('room', room)
            sessionStorage.setItem('name', name)

            window.open('room/', '_self')
        }


        form.addEventListener('button', handleSubmit1)
        form.addEventListener('button', handleSubmit2)
    </script>

{% endblock content %}